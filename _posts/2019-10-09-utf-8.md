---
layout: post
title: UTF-8 UTF-16 ë¬¸ìì—´ í‘œí˜„ ë°©ë²•
date: 2019-10-09 23:35:00
image:
comments: true
categories: linux
tag: utf-8, unicode
---

## UTF-8

UTF-8 ë¬¸ìì—´ì€ 8bit ê¸°ë°˜ìœ¼ë¡œ ë‹¤ìŒê³¼ ê°™ì€ 4ê°€ì§€ íŒ¨í„´ìœ¼ë¡œ í‘œí˜„ëœë‹¤.

```
0xxxxxxx                            // 000000-00007F
110xxxxx 10xxxxxx                   // 000080-0007FF
1110xxxx 10xxxxxx 10xxxxxx          // 000800-00FFFF
11110zzz 10zzxxxx 10xxxxxx 10xxxxxx // 010000-10FFFF
```

### 0xxxxxxx
ASCIIì™€ ë™ì¼í•œ ë²”ìœ„.  
ë§¨ ì• ë°”ì´íŠ¸ê°€ 0ìœ¼ë¡œ ì‹œì‘í•˜ë©´ í•œ ë°”ì´íŠ¸ì§œë¦¬ ASCIIë¬¸ìì´ë‹¤.

### 110xxxxx 10xxxxxx
ì²« ë°”ì´íŠ¸ëŠ” 110ìœ¼ë¡œ ì‹œì‘í•˜ê³ , 10ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” í•œ ë°”ì´íŠ¸ê°€ ë”°ë¼ì˜¨ë‹¤.


### 1110xxxx 10xxxxxx 10xxxxxx
ì²« ë°”ì´íŠ¸ëŠ” 1110ìœ¼ë¡œ ì‹œì‘í•˜ê³ , 10ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ë‘ ë°”ì´íŠ¸ê°€ ë”°ë¼ì˜¨ë‹¤.

### 11110zzz 10zzxxxx 10xxxxxx 10xxxxxx
ì²« ë°”ì´íŠ¸ëŠ” 11110ìœ¼ë¡œ ì‹œì‘í•˜ê³ , ë’¤ì— 10ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ì„¸ ë°”ì´íŠ¸ê°€ ë”°ë¼ì˜¨ë‹¤.

ì•„ë˜ëŠ” utf-8 ë¬¸ìì¸ì§€ ìœ íš¨ì„± ì²´í¬í•˜ëŠ” ì½”ë“œì´ë‹¤.
```c
// 0b10xxxxxx
bool isTrailing(unsigned char b) {
    return (b & 0xC0) == 0x80; // 0xC0=0b11000000, 0x80=0b10000000
}

// 0b0xxxxxxx
bool isLeading1(unsigned char b) {
    return (b & 0x80) == 0;
}

// 0b110xxxxx
bool isLeading2(unsigned char b) {
    return (b & 0xE0) == 0xC0; // 0xE0=0b11100000
}

// 0b1110xxxx
bool isLeading3(unsigned char b) {
    return (b & 0xF0) == 0xE0; // 0xF0=0b11110000
}

// 0b11110xxx
bool isLeading4(unsigned char b) {
    return (b & 0xF8) == 0xF0; // 0xF8=0b11111000
}

bool validateUTF8(const unsigned char* buffer, size_t len) {
    int expected = 0;
    for (size_t i = 0; i < len; ++i) {
        unsigned char b = buffer[i];
        if (isTrailing(b)) {
            if (expected-- > 0)
                continue;
            return false;
        } else if (expected > 0) {
            return false;
        }

        if (isLeading1(b)) {
            expected = 0;
        } else if (isLeading2(b)) {
            expected = 1;
        } else if (isLeading3(b)) {
            expected = 2;
        } else if (isLeading4(b)) {
            expected = 3;
        } else {
            return false;
        }

        return (expected == 0);
    }
}

```

## UTF-16

ì•„ë˜ëŠ” UTF-16BE ê¸°ì¤€ìœ¼ë¡œ ì´ì§„ìˆ˜ë¡œ í‘œí˜„í•œ ê²ƒì´ë‹¤.  
UTF-8ì€ 8bit ê¸°ë°˜ìœ¼ë¡œ UTF-16ì˜ ê²½ìš° 16bit ê¸°ë°˜ì´ë‹¤.
```
// UTF-8ê³¼ ì½”ë“œí¬ì¸íŠ¸ì— ë”°ë¥¸ ë¹„êµ
00000000 0xxxxxxx                   // 000000-00007F
00000xxx xxxxxxxx                   // 000080-0007FF
xxxxxxxx xxxxxxxx                   // 000800-00FFFF
110110zz zzxxxxxx 110111xx xxxxxxxx // 010000-10FFFF

U' = yyyyyyyyyyxxxxxxxxxx  // U - 0x10000
W1 = 110110yyyyyyyyyy      // 0xD800 + yyyyyyyyyy
W2 = 110111xxxxxxxxxx      // 0xDC00 + xxxxxxxxxx
```

### U+0000~U+FFFF
BMP(Basic Multilingual Plane), ê°€ì¥ ë§ì´ ì“°ëŠ” ë¬¸ìë“¤ì´ ì´ ì˜ì—­ì— ìˆë‹¤.  
ë‹¨, U+D800~U+DFFF surrogate ì˜ì—­ì€ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ”ë‹¤. (í•´ë‹¹ ì˜ì—­ì€ ì„œëŸ¬ê²Œì´íŠ¸ ë¬¸ì ì˜ì—­ì´ë‹¤.)

## 00000000|000zzzzz|xxxxxxyy|yyyyyyyy
16bitë¡œ í‘œí˜„í•  ìˆ˜ ì—†ëŠ” ë¬¸ìë“¤ì€ ì„œëŸ¬ê²Œì´íŠ¸ ë¬¸ì ì˜ì—­ì— í•´ë‹¹í•˜ëŠ” ë‘ ê°œì˜ 16bit ë¬¸ìë¡œ ë³€í™˜ë˜ì–´ 32bit í•œìŒìœ¼ë¡œ 010000-10FFFFë¥¼ ì½”ë“œ í¬ì´íŠ¸ë¥¼ í‘œí˜„í•  ìˆ˜ ìˆë‹¤.

### High-Surrogate (U+D800 ... U+DBFF)
110110ZZ|ZZxxxxxx  
<<<<<<< HEAD
ìƒìœ„ ì„œëŸ¬ê²Œì´íŠ¸ëŠ” U+D800 ì—ì„œ U+DBFF ê¹Œì§€ì˜ ê°’ì„ ê°–ëŠ”ë‹¤. ì¦‰ ìµœìƒìœ„ë¹„íŠ¸ 6ê°œì˜ ê°’ì´ ìœ„ë¥¼ ë³´ë“¯ì´ 110110 ìœ¼ë¡œ ì¼ì •í•˜ë‹¤.
=======
ìƒìœ„ ì„œëŸ¬ê²Œì´íŠ¸ëŠ” U+D800 ì—ì„œ U+DBFF ê¹Œì§€ì˜ ê°’ì„ ê°–ëŠ”ë‹¤. ì¦‰ ìµœìƒìœ„ë¹„íŠ¸ 6ê°œì˜ ê°’ì´ ê·¸ë¦¼ì—ì„œ ë³´ë“¯ì´ 110110 ìœ¼ë¡œ ì¼ì •í•˜ë‹¤.
>>>>>>> 1f6b3e117271dd9d43c1f61ae4c544ec5cb75d4d

### Low-Surrogate (U+DC00 ... U+DFFF)
110111yy|yyyyyyyy  
í•˜ìœ„ ì„œëŸ¬ê²Œì´íŠ¸ëŠ” U+DC00 ì—ì„œ U+DFFF ê¹Œì§€ì˜ ê°’ì„ ê°€ì§€ë©° ìµœìƒìœ„ë¹„íŠ¸ 6ê°œì˜ ê°’ì€ 110111 ì´ ëœë‹¤.

ê° ì„œëŸ¬ê²Œì´íŠ¸ ë¬¸ìëŠ” í•˜ìœ„ 10ë¹„íŠ¸ì”©ì˜ ììœ ë„ë¥¼ ê°–ëŠ”ë‹¤. ë”°ë¼ì„œ ì£¼ì–´ì§„ ë¬¸ìë¥¼ 10ë¹„íŠ¸ì”© ë‘ì¡°ê°ì„ ë‚´ì„œ ìƒìœ„ ì„œëŸ¬ê²Œì´íŠ¸ì™€ í•˜ìœ„ ì„œëŸ¬ê²Œì´íŠ¸ì— ë°°ì •í•œ ê²ƒì´ë‹¤.

ì´ ë‘ ê°œì˜ ì„œëŸ¬ê²Œì´íŠ¸ ë¬¸ìëŠ” ìƒìœ„ ì„œëŸ¬ê²Œì´íŠ¸, í•˜ìœ„ ì„œëŸ¬ê²Œì´íŠ¸ë¡œì„œ ì „ì†¡ì´ ëœë‹¤. ì´ ë°©ë²•ìœ¼ë¡œ U+10FFFF ê¹Œì§€ì˜ ë¬¸ìë¥¼ ì¸ì½”ë”© í•  ìˆ˜ ìˆë‹¤.

### Byte Order
ì‹œìŠ¤í…œì— ë”°ë¼ ë°”ì´íŠ¸ ì˜¤ë”ê°€ ë‹¤ë¥´ê²Œ ì €ì¥ë˜ë¯€ë¡œ ì½ì„ ë•Œ Byte Orderë¥¼ í™•ì¸í•´ì•¼í•œë‹¤ Byte Orderì—ëŠ” Big-Endian, Little-Endian ì´ ìˆë‹¤.

ğ·(U+10437)ë¥¼ í‘œí˜„í•  ë•Œ Byte Orderì— ë”°ë¼ ì•„ë˜ì™€ ê°™ì´ í‘œí˜„ëœë‹¤.

* UTF-16BE  
2ì§„ìˆ˜ : 1101 1000 0000 0001 1101 1100 0011 0111  
16ì§„ìˆ˜ : D8 01 DC 37  

* UTF-16LE  
2ì§„ìˆ˜ : 0000 0001 1101 1000 0011 0111 1101 1100  
16ì§„ìˆ˜ : 01 D8 37 DC  

* BOM(Byte Order Mark)  
ë¬¸ì„œ ì•ì— Big-Endianì¸ì§€ Little-Endianì¸ì§€ ì²´í¬í•  ìˆ˜ ìˆë„ë¡ BOMì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
U+FEFFë¬¸ìë¥¼ ë§¨ ì•ì— ë¶™í˜€ì„œ ìˆœì„œë¥¼ ì§ì‘í•  ìˆ˜ ìˆë„ë¡ í•œë‹¤.  
0xFE 0xFF : Big-Endian  
0xFF 0xFE : Little-Endian

## C/C++
utf-8ì€ charë¡œ í‘œí˜„ê°€ëŠ¥í•˜ê³  utf-16ì˜ ê²½ìš° wchar_të¡œ í‘œí˜„ê°€ëŠ¥í•˜ë‹¤. í•˜ì§€ë§Œ wchar_tì˜ ê²½ìš° ë¦¬ëˆ…ìŠ¤ì™€ ìœˆë„ìš°ì¦ˆì˜ í¬ê¸°ê°€ ë‹¤ë¥´ë‹¤. ë¦¬ëˆ…ìŠ¤ê³„ì—´ì—ì„œëŠ” wchar_t í¬ê¸°ê°€ 32bitì´ì§€ë§Œ ìœˆë„ìš°ì¦ˆì—ì„œëŠ” 16bitì´ë‹¤. ê·¸ë˜ì„œ ì„œë¡œ í˜¸í™˜ë˜ëŠ” ì†ŒìŠ¤ì—ì„œëŠ” ë¦¬ëˆ…ìŠ¤ì—ì„œ -fshort-wchar ì˜µì…˜ì„ ì´ìš©í•˜ì—¬ wchar_të¥¼ 16bitë¡œ ë¹Œë“œí•˜ë©´ ì„œë¡œ ì‰½ê²Œ í˜¸í™˜ëœë‹¤. ê·¸ë˜ë„ ë””ë²„ê¹…ì˜ ì–´ë ¤ì›€ ë“±ë“±ì˜ ë‹¨ì ì€ ì¡´ì¬í•œë‹¤.  

ì¶”ê°€ì ìœ¼ë¡œ c++11ì—ì„œ char16_t char32_t íƒ€ì…ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.
ê·¸ë¦¬ê³  u8 u U prefixë¥¼ ë¶™ì—¬ ë¦¬í„°ëŸ´ ë¬¸ìë¥¼ ì„ ì–¸í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤.
```c
const char* nomalChar = "hello"; // const char*
const char* utf8 = u8"hello"; // const char*, encoded as UTF-8
const wchar_t* wideChar =  L"hello"; // const wchar_t*
const char16_t* utf16 =  u"hello"; // const char16_t*, encoded as UTF-16
const char32_t* utf32 =  U"hello"; // const char32_t*, encoded as UTF-32
```

## ê²°ë¡ 
UTF-8, UTF-16 ìš©ëŸ‰ì„ ìƒê°í•´ì•¼í•œë‹¤ë©´ ë‘˜ ì¤‘ì— ì„ íƒì„ í•´ì•¼ í•œë‹¤. ë¬¸ì„œì— ì˜ë¬¸ìë¡œ ì‘ì„±ëœ ë¬¸ì„œë¼ë©´ 1 byteë¡œ í‘œí˜„ê°€ëŠ¥í•œ UTF-8ë¡œ í‘œí˜„í•˜ëŠ”ê²Œ ì¢‹ì„ ê²ƒì´ê³ , í•œê¸€ë¡œ ì‘ì„±ëœ ë¬¸ì„œë¼ë©´ UTF-8ì˜ ê²½ìš° 3 bytes, UTF-16ì˜ ê²½ìš°ì—ëŠ” 2 bytesë¡œ í‘œí˜„í•˜ë¯€ë¡œ UTF-16ìœ¼ë¡œ í‘œí˜„í•˜ëŠ”ê²Œ ì¢‹ì„ ê²ƒì´ë‹¤.

## References
https://ko.wikipedia.org/wiki/UTF-8  
http://en.wikipedia.org/wiki/UTF-16  
Programming Interviews Exposed: Coding Your Way Through the Interview  
https://docs.microsoft.com/ko-kr/cpp/cpp/string-and-character-literals-cpp?view=vs-2019  
